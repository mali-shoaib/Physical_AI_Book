# Implementation Plan: Docusaurus Book Architecture & Module 1 (ROS 2)

**Branch**: `001-ros2-basics` | **Date**: 2025-12-18 | **Spec**: [User input - direct planning request]
**Input**: Create book architecture, chapter structure, writing workflow, and validation steps for Physical AI & Humanoid Robotics textbook

## Summary

Build the foundational Docusaurus architecture for the textbook and implement Module 1 (ROS 2) covering nodes, topics, services, rclpy control, and URDF for humanoid robots. The architecture must support incremental chapter writing, code example validation, RAG chatbot integration, and deployment to GitHub Pages.

## Technical Context

**Language/Version**: Markdown (Docusaurus 3.x), Python 3.10+ (for code examples), Node.js 18+ (for Docusaurus build)
**Primary Dependencies**: Docusaurus 3.x, React 18+, MDX, Prism (syntax highlighting), Mermaid (diagrams)
**Storage**: Static files (Markdown, images, code samples), Git repository
**Testing**: Docusaurus build validation, Markdown linting (markdownlint), code syntax validation (Python AST parser, URDF check_urdf)
**Target Platform**: Web (GitHub Pages), desktop browsers (Chrome, Firefox, Safari, Edge)
**Project Type**: Static site generator (SSG) with documentation focus
**Performance Goals**: Page load <2s on 3G, build time <60s for full site, search index <5MB
**Constraints**: Must work with GitHub Pages (static hosting), no server-side rendering required, all content in Markdown/MDX
**Scale/Scope**: 12+ chapters across 5-6 modules, 50-100 pages total, 200+ code examples

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Principle I: Technical Accuracy ✅
- All ROS 2, Gazebo, Unity, NVIDIA Isaac content will be verified against official docs
- Code examples will reference specific versions (ROS 2 Humble, Gazebo Fortress, etc.)
- Citations will use IEEE/ACM format with URLs and access dates

###

 Principle II: Educational Clarity ✅
- Chapter progression: ROS 2 → Simulation → AI Integration → Capstone
- Each chapter includes: learning objectives, diagrams, examples, exercises
- Technical terms defined on first use with glossary links

### Principle III: Reproducibility (NON-NEGOTIABLE) ✅
- All code examples will be complete, runnable scripts (not pseudocode)
- Installation instructions specify exact versions and dependencies
- Examples tested in Docker containers (Ubuntu 22.04 + ROS 2 Humble)
- URDF files validated with check_urdf before inclusion

### Principle IV: Multi-Platform Support ✅
- Module 1: ROS 2 (rclpy, URDF)
- Module 2: Gazebo + Unity (deferred to future planning)
- Module 3: NVIDIA Isaac Sim (deferred)
- Each platform chapter includes setup, hello-world, debugging steps

### Principle V: RAG Accuracy ✅
- RAG chatbot will be integrated as Docusaurus plugin or separate UI component
- Text chunking strategy: semantic sections (headings as boundaries), 500-1000 tokens per chunk
- Embedding model: OpenAI text-embedding-3-small
- Vector DB: Qdrant Cloud (hosted), PostgreSQL (Neon) for conversation history
- User can select chapters/sections to query (chapter-level filtering)

### Principle VI: AI-Native Workflow ✅
- Using `/sp.plan` for architecture planning
- Will use `/sp.tasks` for task breakdown
- ADRs for significant decisions (Docusaurus vs alternatives, RAG integration strategy)

### Principle VII: Citation Standards ✅
- All external sources cited in IEEE/ACM format
- Official docs: URL + access date
- Code repos: GitHub URL + commit hash or release tag
- Research papers: DOI when available

**Constitution Gate Status: PASS** ✅

## Project Structure

### Documentation (this feature)

```text
specs/001-ros2-basics/
├── plan.md              # This file
├── research.md          # Phase 0: Docusaurus best practices, RAG integration patterns
├── data-model.md        # Phase 1: Chapter metadata, sidebar structure, RAG chunk schema
├── quickstart.md        # Phase 1: How to add a new chapter, run build, test locally
├── contracts/           # Phase 1: Sidebar config schema, frontmatter schema, RAG API contract
└── tasks.md             # Phase 2: Generated by /sp.tasks (not created by /sp.plan)
```

### Source Code (repository root)

```text
# Docusaurus project structure (to be created)
docs/                     # Markdown content root
├── intro.md              # Landing page
├── module-1-ros2/        # Module 1: ROS 2
│   ├── ch1-ros2-basics.md
│   ├── ch2-rclpy-control.md
│   └── ch3-urdf-humanoids.md
├── module-2-simulation/  # Module 2: Gazebo + Unity (future)
├── module-3-isaac/       # Module 3: NVIDIA Isaac (future)
├── module-4-vla/         # Module 4: Vision-Language-Action models (future)
├── module-5-capstone/    # Module 5: End-to-end project (future)
└── assets/               # Images, diagrams, URDF files, code samples
    ├── images/
    ├── urdf/
    └── code/

src/                      # Docusaurus React components (if needed for RAG UI)
├── components/
│   └── ChatbotWidget.tsx # RAG chatbot UI component
├── css/
│   └── custom.css
└── pages/
    └── index.tsx         # Custom homepage

static/                   # Static assets served as-is
├── img/
└── files/

docusaurus.config.js      # Docusaurus configuration
sidebars.js               # Sidebar navigation structure
package.json              # Node dependencies
```

**Structure Decision**: Docusaurus static site with modular chapter organization. Each module gets its own directory under `docs/`. RAG chatbot integrated as custom React component in Docusaurus theme.

## Complexity Tracking

> **No constitution violations requiring justification**

## Phase 0: Research & Decisions

**Objective**: Resolve technical uncertainties about Docusaurus setup, RAG integration, and code validation workflow.

### Research Tasks

1. **Docusaurus Configuration**
   - Research: Official Docusaurus 3.x setup for technical documentation
   - Questions:
     - How to configure sidebar auto-generation vs manual sidebar.js?
     - How to enable versioning for future book editions?
     - Best practices for organizing large doc sites (12+ chapters)?
     - How to integrate Mermaid diagrams and custom React components?

2. **Code Example Format**
   - Research: Best practices for embedding runnable code in Docusaurus
   - Questions:
     - Use inline code blocks with copy button, or link to GitHub repo files?
     - How to validate Python/ROS 2 syntax without executing (AST parsing)?
     - How to include URDF files and make them downloadable?
     - Code highlighting for ROS 2 Python (custom Prism grammar needed)?

3. **RAG Chatbot Integration**
   - Research: Strategies for integrating custom UI into Docusaurus
   - Questions:
     - Swizzle Docusaurus theme to add chatbot widget, or use plugin?
     - How to extract Markdown content for RAG chunking (build-time vs runtime)?
     - Text chunking strategy: heading-based vs fixed-size vs semantic?
     - How to handle code blocks in embeddings (include as-is, summarize, or exclude)?

4. **Build & Deployment Workflow**
   - Research: GitHub Pages deployment for Docusaurus, CI/CD for validation
   - Questions:
     - GitHub Actions workflow for build + deploy (on push to main)?
     - How to validate all links, images, and sidebar routes (broken-link checker)?
     - How to test code examples in CI (Docker container with ROS 2 Humble)?
     - Deployment: gh-pages branch vs docs/ folder in main?

**Output**: `research.md` with decisions and rationale for each question

## Phase 1: Design

**Prerequisites**: `research.md` complete

### Data Model (`data-model.md`)

**Entities**:

1. **Chapter**
   - Fields: id (string), title (string), module (string), order (number), path (string), frontmatter (ChapterMetadata)
   - Frontmatter: sidebar_label, sidebar_position, description, keywords[], authors[], last_updated (date)
   - Relationships: Chapter belongs to Module, Chapter has many CodeExamples

2. **Module**
   - Fields: id (string), title (string), description (string), order (number), chapters (Chapter[])
   - Examples: "module-1-ros2", "module-2-simulation", etc.

3. **CodeExample**
   - Fields: id (string), language (string), file_path (string), code (string), validated (boolean), validation_date (date)
   - Languages: python, xml (URDF), yaml, bash
   - Validation: AST parsing for Python, check_urdf for URDF, YAML linting

4. **RAGChunk**
   - Fields: chunk_id (string), chapter_id (string), content (string), heading_path (string[]), embedding (float[]), metadata (object)
   - Metadata: { module, chapter, section, has_code, keywords }
   - Chunking strategy: Split on headings (## and ###), max 1000 tokens, preserve code blocks

5. **SidebarConfig**
   - Fields: type ("category" | "doc"), label (string), items (SidebarItem[]), collapsed (boolean)
   - Generates: sidebars.js configuration

### API Contracts (`contracts/`)

**1. Sidebar Configuration Schema** (`contracts/sidebar-schema.json`)

```json
{
  "type": "category",
  "label": "Module 1: ROS 2",
  "collapsed": false,
  "items": [
    { "type": "doc", "id": "module-1-ros2/ch1-ros2-basics", "label": "Chapter 1: ROS 2 Basics" },
    { "type": "doc", "id": "module-1-ros2/ch2-rclpy-control", "label": "Chapter 2: rclpy Control" },
    { "type": "doc", "id": "module-1-ros2/ch3-urdf-humanoids", "label": "Chapter 3: URDF for Humanoids" }
  ]
}
```

**2. Chapter Frontmatter Schema** (`contracts/chapter-frontmatter-schema.yaml`)

```yaml
---
id: ch1-ros2-basics
title: "Chapter 1: ROS 2 Basics - Nodes, Topics, Services"
sidebar_label: "Ch1: ROS 2 Basics"
sidebar_position: 1
description: "Introduction to ROS 2 architecture, nodes, topics, and services for humanoid robotics."
keywords:
  - ROS 2
  - nodes
  - topics
  - services
  - rclpy
authors:
  - name: "Physical AI Team"
last_updated: 2025-12-18
---
```

**3. RAG API Contract** (`contracts/rag-api.yaml`)

```yaml
# FastAPI endpoints for RAG chatbot
POST /api/chat/query:
  request:
    query: string           # User question
    chapter_ids: string[]   # Optional: filter to specific chapters
    conversation_id: string # For history tracking
  response:
    answer: string
    sources: object[]       # { chapter, section, snippet }
    confidence: number      # 0.0-1.0

GET /api/chapters:
  response:
    chapters: object[]      # { id, title, module }

POST /api/embedding/update:
  request:
    chapter_id: string
    force: boolean          # Re-embed even if exists
  response:
    chunks_created: number
    status: "success" | "failed"
```

### Quickstart (`quickstart.md`)

**For Content Authors**:
1. How to add a new chapter (file structure, frontmatter, sidebar entry)
2. How to include code examples (syntax, validation requirements)
3. How to add diagrams (Mermaid syntax, image formats)
4. How to test locally (`npm run start`, `npm run build`)

**For Developers**:
1. How to modify Docusaurus config (docusaurus.config.js, sidebars.js)
2. How to add custom React components (chatbot widget)
3. How to run validation scripts (code syntax, link checking)
4. How to deploy to GitHub Pages (manual vs GitHub Actions)

## Phase 1 Constitution Re-Check

**Principle III (Reproducibility) Re-validation**:
- All code examples in Module 1 will be validated with:
  - Python: `python -m py_compile <file>` (syntax check)
  - URDF: `check_urdf <file>` (ROS 2 tool)
  - Bash: `shellcheck <file>` (if applicable)
- Docker image: `ros:humble` base + dependencies documented in quickstart.md

**Principle V (RAG Accuracy) Re-validation**:
- RAG system will NOT answer questions outside embedded content
- System prompt template: "Answer ONLY using the following book content. If the answer is not in the provided text, respond: 'I don't have information on that topic in the selected chapters.'"
- Validation tests: Out-of-scope questions (e.g., "How do I build a drone?") must return refusal

**Status: PASS** ✅

## Dependencies & Risks

**Dependencies**:
- Docusaurus 3.x stable release (available)
- ROS 2 Humble (LTS, stable)
- Qdrant Cloud (managed vector DB)
- Neon Postgres (managed PostgreSQL)
- GitHub Pages (free tier, 1GB limit)

**Risks**:

1. **Risk**: GitHub Pages 1GB limit may be exceeded with large images/URDF files
   - **Mitigation**: Use image optimization (WebP, compression), host large files on separate CDN or GitHub LFS
   - **Blast Radius**: Would block deployment; detected at build time
   - **Kill Switch**: Fall back to Netlify or Vercel (free tiers support larger sites)

2. **Risk**: Code examples may break with ROS 2 updates (Humble → Iron → Jazzy)
   - **Mitigation**: Pin to ROS 2 Humble (LTS until 2027), document upgrade path in quickstart
   - **Blast Radius**: Affects reproducibility principle; requires chapter updates
   - **Guardrail**: Automated CI tests run examples in Docker container monthly

3. **Risk**: RAG chatbot may hallucinate despite prompt engineering
   - **Mitigation**: Use retrieval-augmented generation with strict context filtering, log all responses for auditing
   - **Blast Radius**: Undermines Principle V (RAG Accuracy); damages credibility
   - **Kill Switch**: Disable chatbot if hallucination rate >5% in testing, fall back to search-only

## Next Steps

1. **Complete Phase 0**: Generate `research.md` with Docusaurus setup decisions, RAG integration strategy, code validation workflow
2. **Complete Phase 1**: Generate `data-model.md`, `contracts/`, `quickstart.md`
3. **Run `/sp.tasks`**: Generate task list for implementation (Docusaurus setup, Module 1 chapters, RAG integration)
4. **ADR Decision Point**: Document Docusaurus vs alternatives (MkDocs, Sphinx, GitBook) - use `/sp.adr` if requested

## Definition of Done

- [ ] `research.md` complete with all technical decisions documented
- [ ] `data-model.md` defines chapter, module, code example, and RAG chunk schemas
- [ ] `contracts/` contains sidebar, frontmatter, and RAG API schemas
- [ ] `quickstart.md` provides step-by-step guide for authors and developers
- [ ] Constitution Check passes for all principles
- [ ] No unresolved "NEEDS CLARIFICATION" items in Technical Context
